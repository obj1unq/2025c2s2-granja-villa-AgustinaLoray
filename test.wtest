import mercados.*
import cultivos.*
import aspersor.*
import wollok.game.*
import personaje.*

describe "Sembrar" {
  test "sembrar maiz" {
    personaje.sembrarMaiz()
    assert.that(personaje.objetoEncima().first().kindName() == "a Maiz")
  }

  test "sembrar trigo" {
    personaje.sembrarTrigo()
    assert.that(personaje.objetoEncima().first().kindName() == "a Trigo")
  }

  test "sembrar tomaco" {
    personaje.sembrarTomaco()
    assert.that(personaje.objetoEncima().first().kindName() == "a Tomaco")
  }
}

describe "Regar" {
  test "regar maiz" {
    personaje.sembrarMaiz()
    personaje.regar()
    assert.that(not personaje.objetoEncima().first().esBebe())
  }

  test "regar trigo" {
    personaje.sembrarTrigo()
    personaje.regar()
    assert.that(personaje.objetoEncima().first().etapaDeEvolucion() == 1)
  }

  test "regar tomaco" {
    personaje.sembrarTomaco()
    personaje.regar()
    assert.that(personaje.objetoEncima().first().image() == "tomaco.png") 
    //no se me ocurre otra manera pero no funciona :(
  }
}

describe "Cosechar" {
  test "cosechar maiz" {
    personaje.sembrarMaiz()
    personaje.regar()
    personaje.cosechar()
    assert.that(personaje.listaDeVenta().size() == 1)
  }

  test "cosechar trigo" {
    personaje.sembrarTrigo()
    personaje.regar()
    personaje.regar()
    personaje.cosechar()
    assert.that(personaje.listaDeVenta().size() == 1)
  }

  test "cosechar tomaco" {
    personaje.sembrarTomaco()
    personaje.regar()
    assert.that(personaje.objetoEncima().isEmpty())
  }
}

describe "Aspersores" {
  test "poner aspersor" {
    personaje.ponerAspersor()
    assert.that(personaje.aspersores().size() == 1)
  }

  test "regar con aspersor maiz" {
    personaje.position(game.at(3,3))
    var pos = game.at(3,4)
    var maiz = new Maiz(position = pos, esBebe = true)
    game.addVisual(maiz)
    personaje.ponerAspersor()
    personaje.activarAspersor()
    var maizDespues = game.getObjectsIn(pos)
    assert.that(maizDespues.first().kindName() == "a Maiz")
    assert.that(maizDespues.first().image() == "corn_adult.png")
  }

  test "regar con aspersor trigo" {
    personaje.position(game.at(5,5))
    var pos = game.at(4,5)
    var trigo = new Trigo(position = pos, etapaDeEvolucion = 0)
    game.addVisual(trigo)
    personaje.ponerAspersor()
    personaje.activarAspersor()
    var trigoDespues = game.getObjectsIn(pos)
    assert.that(trigoDespues.first().kindName() == "a Trigo")
    assert.that(trigoDespues.first().etapaDeEvolucion() == 1)
  }

}

describe "Venta mercado" {
  test "venta" {
    personaje.position(game.at(2,2))
    personaje.sembrarMaiz()
    personaje.regar()
    personaje.cosechar()
    var nuevoMercado = new Mercado(position = game.at(1,1), monedas = 1000)
    game.addVisual(nuevoMercado)
    personaje.position(game.at(1,1))
    personaje.vender()
    assert.that(personaje.cantidadDeMonedas() == 150)
    assert.that(personaje.listaDeVenta().isEmpty())
    assert.that(nuevoMercado.monedas() == 850)
  }
}